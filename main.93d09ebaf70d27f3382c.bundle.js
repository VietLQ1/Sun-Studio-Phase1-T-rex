(()=>{"use strict";class t{static loadImage(t){return new Promise(((e,i)=>{const s=new Image;s.onload=()=>{e(s),this.assetMap.set(t,s)},s.onerror=()=>i(new Error(`Failed to load image at ${t}`)),s.src=t}))}static loadImages(e){return Promise.all(e.map((e=>t.loadImage(e))))}static loadAudio(t){return new Promise(((e,i)=>{const s=new Audio;s.oncanplaythrough=()=>{e(s),this.assetMap.set(t,s)},s.onerror=()=>i(new Error(`Failed to load audio at ${t}`)),s.src=t}))}static loadAudios(e){return Promise.all(e.map((e=>t.loadAudio(e))))}}t.assetMap=new Map;class e{constructor(e){t.assetMap.has(e)?(this._image=t.assetMap.get(e),console.log("Sprite loaded from assetMap")):(this._image=new Image,this._image.src=e,this._image.onload=()=>{})}render(t,e,i,s){let n=document.querySelector("canvas").getContext("2d");null!=n?n.drawImage(this._image,t,e,i,s):console.error("2D context is null")}}class i{constructor(){this._scenes=[]}addScene(t){this._scenes.push(t)}loadScene(t){var e;this._scenes[t].onSceneLoad(),null===(e=this._currentScene)||void 0===e||e.onSceneUnload(),this._currentScene=this._scenes[t]}get currentScene(){return this._currentScene}static getInstance(){return this._instance||(this._instance=new i),this._instance}}class s{constructor(){window.navigator.userAgent.match(/Mobile/)||window.navigator.userAgent.match(/Tablet/)?this._isMobile=!0:this._isMobile=!1,this._menuText="Press Button to Start",this._gameOverText="Press Restart or ESC to go back to Menu",this._isMobile&&(this._menuText="Tap Start Game",this._gameOverText="Tap Restart")}static getInstance(){return this._instance||(this._instance=new s),this._instance}get isMobile(){return this._isMobile}set isMobile(t){this._isMobile=t}get menuText(){return this._menuText}get gameOverText(){return this._gameOverText}}class n{constructor(t,e){this._renderer=t,this._gameObjects=[],this._canvas=e}update(t,e){for(let i=0;i<this._gameObjects.length;i++)this._gameObjects[i].update(t,e)}render(){this._renderer.clear();for(let t=0;t<this._gameObjects.length;t++)this._gameObjects[t].render()}addGameObject(t){this._gameObjects.push(t)}get gameObjects(){return this._gameObjects}}class a{constructor(e){if(t.assetMap.has(e))return this._audio=t.assetMap.get(e),void console.log("Audio loaded from assetMap");this._audio=new Audio(e)}play(){this._audio.loop=!1,this._audio.play().catch((t=>{}))}playLoop(){this._audio.loop=!0,this._audio.play().catch((t=>{}))}pause(){this._audio.pause()}changeVolume(t){this._audio.volume=t}mute(){this._audio.muted=!0}unmute(){this._audio.muted=!1}}class o{constructor(){this._volume=.5,this._audioClips=new Map}static getInstance(){return o._instance||(o._instance=new o),o._instance}addAudioClip(t,e){var i;this._audioClips.has(t)||(this._audioClips.set(t,new a(e)),null===(i=this._audioClips.get(t))||void 0===i||i.changeVolume(this._volume))}getAudioClip(t){return this._audioClips.get(t)}changeVolume(t){this._volume=t;for(let t of this._audioClips.values())t.changeVolume(this._volume)}playAudioClip(t,e=!1){let i=this._audioClips.get(t);i&&!e?i.play():i&&e&&i.playLoop()}mute(){for(let t of this._audioClips.values())t.mute()}unmute(){for(let t of this._audioClips.values())t.unmute()}}class h{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}isCollidingWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}}class r{constructor(t=0,e=0){this.position=[t,e,0],this.rotation=[0,0,0],this.scale=[1,1,1]}get tag(){return this._tag}get width(){return this._width}get height(){return this._height}}class d extends r{constructor(t,e,i,s,n,a,o,r,d,c){super(window.innerWidth-t*window.innerWidth/1920,window.innerHeight-e*window.innerHeight/1080),this.collider=new h(this.position[0],this.position[1],0,0),this._x=t,this._y=e,this._width=i,this._height=s,this._text=n,this._isBold=a,this._fontSize=o,this._font=r,this._color=d,this._backgroundColor=c}update(t,e){this.position[0]=window.innerWidth-this._x*window.innerWidth/1920,this.position[1]=window.innerHeight-this._y*window.innerHeight/1080;let i=e.getLastClick();if(i&&i.x>=this.position[0]&&i.x<=this.position[0]+this._width&&i.y>=this.position[1]&&i.y<=this.position[1]+this._height)e.clearTouch(),this.onButtonClicked();else{let t=e.getTouchEnd();t&&t.x>=this.position[0]&&t.x<=this.position[0]+this._width&&t.y>=this.position[1]&&t.y<=this.position[1]+this._height&&(e.clearTouch(),this.onButtonClicked())}}render(){let t=document.querySelector("canvas").getContext("2d");null!=t?(t.fillStyle=this._backgroundColor,t.fillRect(this.position[0],this.position[1],this._width,this._height),t.font=this._fontSize+"px "+this._font,this._isBold&&(t.font="bold "+t.font),t.fillStyle=this._color,t.textAlign="center",t.textBaseline="middle",t.fillText(this._text,this.position[0]+this._width/2,this.position[1]+this._height/2)):console.error("2D context is null")}onCollisionEnter(t){}onButtonClicked(){}set text(t){this._text=t}}class c extends d{constructor(){console.log(window.innerWidth,window.innerHeight),super(1100,480,200,100,"Start Game",!0,30,"Arial","blue","orange"),o.getInstance().addAudioClip("button","assets/audios/button.mp3")}update(t,e){super.update(t,e),e.clearTouch()}render(){super.render()}onButtonClicked(){var t;i.getInstance().loadScene(1),null===(t=o.getInstance().getAudioClip("button"))||void 0===t||t.play()}}class l extends n{onSceneLoad(){this._gameObjects=[],this._renderer.clear(),this.addGameObject(new c)}onSceneUnload(){}update(t,e){super.update(t,e),e.getTouchStart()&&s.getInstance().isMobile&&document.hasFocus()||e.getTouchEnd()&&document.hasFocus()&&(s.getInstance().isMobile=!0,e.clearTouch())}render(){super.render();var t=this._canvas.getContext("2d");t?(t.font="bold 50px Arial",t.textAlign="center",t.textBaseline="middle",t.fillStyle="black",t.fillText(s.getInstance().menuText,window.innerWidth/2,window.innerHeight/2)):console.log("Failed to get 2d context")}}class u{constructor(){this._frame=0}setState(t){this._currentState=t}update(t){this._currentState.update(this._frame++)}render(t,e,i,s){this._currentState.render(t,e,i,s)}addSprite(t){this._currentState.addSprite(t)}}class g extends r{constructor(){super(),this._animator=new u}update(t,e){this._animator.update(t)}render(){this._animator.render(this.position[0],this.position[1],this._width,this._height)}onCollisionEnter(t){}}class _{constructor(){this._playerScore=0,this._highScore=localStorage.getItem("highScore")?parseInt(localStorage.getItem("highScore")):0}static getInstance(){return this._instance||(this._instance=new _),this._instance}get score(){return this._playerScore}get highScore(){return this._highScore}resetScore(){this._playerScore=0}increaseScore(t){this._playerScore+=10*t,this._playerScore>this._highScore&&(this._highScore=this._playerScore,localStorage.setItem("highScore",this._highScore.toString()))}}class p extends g{constructor(){super(),this._tag="obstacle",this.position[0]=Math.max(window.innerWidth,1536)+100*Math.random()}update(t,e){this.position[0]-=.08*t*this._speed*(1+_.getInstance().score/2e3),this.collider.x=this.position[0],this.collider.y=this.position[1],super.update(t,e)}render(){super.render()}onCollisionEnter(t){}}class w{constructor(){this._sprites=[],this._currentSprite=0}update(t){t%10==0&&(this._currentSprite++,this._currentSprite>=this._sprites.length&&(this._currentSprite=0))}render(t,e,i,s){this._sprites[this._currentSprite].render(t,e,i,s)}addSprite(t){this._sprites.push(t)}}class m extends p{constructor(){super(),this._width=60*window.innerHeight/1080,this._height=60*window.innerHeight/1080,this._speed=1e4,this.position[1]=window.innerHeight-this._height-180*window.innerHeight/1080,this._animator.setState(new w),this._animator.addSprite(new e("assets/images/bird_flap_0.png")),this._animator.addSprite(new e("assets/images/bird_flap_1.png")),this._animator.addSprite(new e("assets/images/bird_flap_2.png")),this.collider=new h(this.position[0],this.position[1],this._width,this._height)}update(t,e){super.update(t,e)}render(){super.render()}onCollisionEnter(t){}}class S extends p{constructor(){super(),this._width=80*window.innerHeight/1080,this._height=100*window.innerHeight/1080,this._speed=8e3,this.position[1]=window.innerHeight-this._height,this.collider=new h(this.position[0],this.position[1],this._width,this._height),this._animator.setState(new w),this._animator.addSprite(new e("assets/images/pixel_cactus.png"))}update(t,e){super.update(t,e)}render(){super.render()}onCollisionEnter(t){}}class b{constructor(){this._sprites=[],this._currentSprite=0,this._sprites.push(new e("assets/images/seiba_hurt.png"))}update(t){}render(t,e,i,s){this._sprites[this._currentSprite].render(t,e,i,s)}addSprite(t){this._sprites.push(t)}}class v{constructor(t,e,i=1,s=4900,n=!1){this._gameObject=t,this._isGrounded=e,this._velocity=[0,0],this._gravity=s,i<=0&&(i=1),this._mass=i,this._isKinematic=n}update(t){this._isKinematic||this._isGrounded||(this._velocity[1]-=this._gravity*t*window.innerHeight/1080,this._gameObject.position[1]-=this._velocity[1]*t,this._gameObject.position[1]>=window.innerHeight-this._gameObject.height&&(this._gameObject.position[1]=window.innerHeight-this._gameObject.height,this._isGrounded=!0,this._velocity[1]=0)),this._gameObject.position[0]+=this._velocity[0]*t}applyForce(t){this._velocity[0]+=t[0]/this._mass,this._velocity[1]+=t[1]/this._mass,this._isGrounded&&t[1]>0&&(this._isGrounded=!1)}get velocity(){return this._velocity}get isGrounded(){return this._isGrounded}}class y extends g{constructor(){super(),this._isDuck=!1,this._jumpForce=1500*window.innerHeight/1080,this._rigidbody=new v(this,!0),this._alive=!0,this._width=160*window.innerHeight/1080,this._height=200*window.innerHeight/1080,this._tag="player",this.position[0]=window.innerWidth/5-this._width/2,this.position[1]=window.innerHeight-this._height,o.getInstance().addAudioClip("jump","assets/audios/jump.wav"),o.getInstance().addAudioClip("collide","assets/audios/collide.wav"),this._animator.setState(new w),this.collider=new h(this.position[0],this.position[1],this._width,this._height),this._animator.addSprite(new e("assets/images/seiba_walking_0.png")),this._animator.addSprite(new e("assets/images/seiba_walking_1.png")),this._animator.addSprite(new e("assets/images/seiba_walking_2.png")),this._animator.addSprite(new e("assets/images/seiba_walking_3.png"))}update(t,e){var i;if(!this._alive)return;let s=e.getTouchStart();(e.isKeyPressed("KeyW")||e.isKeyPressed("Space")||s&&s.x>window.innerWidth/2)&&this._rigidbody.isGrounded&&!this._isDuck&&(this._rigidbody.applyForce([0,this._jumpForce]),null===(i=o.getInstance().getAudioClip("jump"))||void 0===i||i.play(),console.log("jump")),this._rigidbody.update(t),this._rigidbody.isGrounded||e.clearTouch(),(e.isKeyPressed("KeyS")||s&&s.x<window.innerWidth/2&&null==e.getTouchEnd())&&this._rigidbody.isGrounded?(this._isDuck=!0,this._height=100*window.innerHeight/1080,this.position[1]=window.innerHeight-this._height):this._rigidbody.isGrounded&&(e.clearTouch(),this._height=200*window.innerHeight/1080,this.position[1]=window.innerHeight-this._height,this._isDuck=!1),this.collider.x=this.position[0],this.collider.y=this.position[1],this.collider.height=this._height,super.update(t,e)}render(){super.render()}onCollisionEnter(t){var e;this._animator.setState(new b),"obstacle"==t.tag&&i.getInstance().loadScene(2),null===(e=o.getInstance().getAudioClip("collide"))||void 0===e||e.play(),this._alive=!1}}class x extends m{constructor(){super(),this.position[1]=window.innerHeight-2*this._height}}class C extends g{constructor(){super(),this.collider=new h(0,0,0,0),this._tag="bg",this.position[0]=0,this.position[1]=0,this._animator.setState(new w)}update(t,e){this.position[0]+=.1*t*this._speed,super.update(t,e)}render(){super.render()}}class f extends C{constructor(){super(),this._speed=5e3+3e3*Math.random(),this._width=100*window.innerHeight/1080,this._height=100*window.innerHeight/1080,this.position[1]=2*this._height*window.innerHeight/1080,this._animator.addSprite(new e("assets/images/dragon_0.png")),this._animator.addSprite(new e("assets/images/dragon_1.png")),this._animator.addSprite(new e("assets/images/dragon_2.png")),this._animator.addSprite(new e("assets/images/dragon_3.png"))}update(t,e){super.update(t,e),this.position[0]>window.innerWidth&&(this.position[0]=-this._width-1e3*Math.random())}}class I extends n{onSceneLoad(){this._delay=0,_.getInstance().resetScore(),this.addGameObject(new y),this.addGameObject(new f),this.addGameObject(new S),this._renderer.clear()}onSceneUnload(){this._gameObjects=[]}update(t,e){if(super.update(t,e),2==this.gameObjects.length||this._gameObjects[2].position[0]<=window.innerWidth/3&&this.gameObjects.length<4){let t=Math.random();t<.4?this.addGameObject(new S):t<.7?this.addGameObject(new x):this.addGameObject(new m)}for(let t=2;t<this._gameObjects.length;t++)this._gameObjects[t].position[0]<-this._gameObjects[t].collider.width&&this._gameObjects.splice(t,1);document.hasFocus()?_.getInstance().increaseScore(t):i.getInstance().loadScene(0)}render(){super.render();var t=this._canvas.getContext("2d");t?(t.font="bold 50px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("Score: "+Math.floor(_.getInstance().score),window.innerWidth/2,50)):console.log("Failed to get 2d context")}}class T extends d{constructor(){super(1100,480,200,100,"Restart",!0,30,"Arial","blue","pink"),o.getInstance().addAudioClip("button","assets/audios/button.mp3")}update(t,e){super.update(t,e)}render(){super.render()}onButtonClicked(){var t;i.getInstance().loadScene(1),null===(t=o.getInstance().getAudioClip("button"))||void 0===t||t.play()}}class j extends n{onSceneLoad(){this._delay=0,this.addGameObject(i.getInstance().currentScene.gameObjects[0])}onSceneUnload(){this._gameObjects=[],this._delay=0}update(t,e){super.update(t,e),this._delay+=10*t,this._delay>10&&1==this.gameObjects.length&&this.addGameObject(new T),this._delay>10&&e.isKeyPressed("Escape")?(this._delay=0,i.getInstance().loadScene(0)):e.clearTouch()}render(){super.render();var t=this._canvas.getContext("2d");t?(localStorage.setItem("highScore",_.getInstance().highScore.toString()),t.fillStyle="black",t.font="bold 50px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("Your Score: "+Math.floor(_.getInstance().score),window.innerWidth/2,50),t.fillText("High Score: "+Math.floor(_.getInstance().highScore),window.innerWidth/2,100),t.fillText(s.getInstance().gameOverText,window.innerWidth/2,window.innerHeight/2)):console.log("Failed to get 2d context")}}class O{constructor(){this.keys={},this.touchStart=null,this.touchEnd=null,this.lastClick=null,window.addEventListener("keydown",(t=>this.keys[t.code]=!0)),window.addEventListener("keyup",(t=>this.keys[t.code]=!1)),window.addEventListener("touchstart",(t=>this.handleTouchStart(t))),window.addEventListener("touchend",(t=>this.handleTouchEnd(t))),window.addEventListener("click",(t=>this.handleMouseClick(t)))}handleTouchStart(t){this.touchStart={x:t.touches[0].clientX,y:t.touches[0].clientY}}handleTouchEnd(t){t.changedTouches&&t.changedTouches[0]&&(this.touchEnd={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY})}handleMouseClick(t){this.lastClick={x:t.clientX,y:t.clientY}}getLastClick(){return this.lastClick}isKeyPressed(t){return!!this.keys[t]}getTouchStart(){return this.touchStart}getTouchEnd(){return this.touchEnd}clearTouch(){this.touchStart=null,this.touchEnd=null,this.lastClick=null}}class k{constructor(t){this.BGX=0,this.canvas=t,this.BG=new Image,this.resizeCanvas(),window.addEventListener("resize",(()=>this.resizeCanvas()))}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}render(t){t.render()}setBG(e){if(t.assetMap.has(e)&&t.assetMap.get(e)instanceof HTMLImageElement)return this.BG=t.assetMap.get(e),void console.log("BG set from asset map");this.BG.src=e}clear(){var t,e,i;null===(t=this.canvas.getContext("2d"))||void 0===t||t.clearRect(0,0,this.canvas.width,this.canvas.height),null===(e=this.canvas.getContext("2d"))||void 0===e||e.drawImage(this.BG,this.BGX,0,this.canvas.width,this.canvas.height),null===(i=this.canvas.getContext("2d"))||void 0===i||i.drawImage(this.BG,this.BGX+this.canvas.width,0,this.canvas.width,this.canvas.height),this.BGX--,this.BGX<-this.canvas.width&&(this.BGX=0)}}class G{constructor(){}static getInstance(){return this._instance||(this._instance=new G),this._instance}checkCollisions(t){let e=t.gameObjects;for(let t=0;t<e.length;t++)for(let i=t+1;i<e.length;i++){const s=e[t],n=e[i];s.collider.isCollidingWith(n.collider)&&this.handleCollision(s,n)}}handleCollision(t,e){t.onCollisionEnter(e),e.onCollisionEnter(t)}}class M{constructor(t){console.log("Game created"),this.renderer=new k(t),this.input=new O,this.lastFrameTime=0}loadAssets(){return e=this,i=void 0,n=function*(){if(!this._iPath||!this._aPath)throw new Error("Paths not set");yield t.loadImages(this._iPath),yield t.loadAudios(this._aPath)},new((s=void 0)||(s=Promise))((function(t,a){function o(t){try{r(n.next(t))}catch(t){a(t)}}function h(t){try{r(n.throw(t))}catch(t){a(t)}}function r(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(o,h)}r((n=n.apply(e,i||[])).next())}));var e,i,s,n}start(t){requestAnimationFrame((t=>this.gameLoop(t)))}gameLoop(t){const e=(t-this.lastFrameTime)/1e3;this.lastFrameTime=t;let s=i.getInstance().currentScene;s.update(e,this.input),G.getInstance().checkCollisions(s),this.renderer.render(s),requestAnimationFrame((t=>this.gameLoop(t)))}}const A=document.createElement("canvas");document.body.appendChild(A),new e("assets/images/phaser-logo.png"),new class extends M{constructor(t){super(t),this._aPath=["assets/audios/jump.wav","assets/audios/collide.wav","assets/audios/button.mp3"],this._iPath=["assets/images/BG.png","assets/images/pixel_cactus.png","assets/images/bird_flap_0.png","assets/images/bird_flap_1.png","assets/images/bird_flap_2.png","assets/images/dragon_0.png","assets/images/dragon_1.png","assets/images/dragon_2.png","assets/images/dragon_3.png","assets/images/seiba_hurt.png","assets/images/seiba_walking_0.png","assets/images/seiba_walking_1.png","assets/images/seiba_walking_2.png","assets/images/seiba_walking_3.png"],this.loadAssets().then((()=>{this.start(0)})).catch((t=>{console.error("Failed to load assets:",t)}))}start(t){i.getInstance().addScene(new l(this.renderer,A)),i.getInstance().addScene(new I(this.renderer,A)),i.getInstance().addScene(new j(this.renderer,A)),i.getInstance().loadScene(0),super.start(t),this.renderer.setBG("assets/images/BG.png")}}(A)})();